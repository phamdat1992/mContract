FROM richarvey/nginx-php-fpm:1.7.3

ADD nginx.conf /etc/nginx/sites-available/default.conf

ARG RABBITMQ_HOST
ARG RABBITMQ_USER
ARG RABBITMQ_PASS
ARG RABBITMQ_PORT
ARG RABBITMQ_ROUTINGKEY
ARG RABBITMQ_VIRTUALHOST

ARG MYSQL_HOST
ARG MYSQL_USERNAME
ARG MYSQL_PASSWORD

ARG CAT_HOST
ARG CAT_USERNAME
ARG CAT_PASSWORD

ARG THUMBOR_URL
ARG ENABLE_XDEBUG

ARG GOOGLE_OAUTH_CLIENT_ID
ARG GOOGLE_OAUTH_CLIENT_SECRET
ARG GOOGLE_OAUTH_REDIRECT_URL_AGENT
ARG GOOGLE_OAUTH_REDIRECT_URL_PICKUP
ARG GOOGLE_API_KEY

ARG COPYCAT_HOST
ARG COPYCAT_USERNAME
ARG COPYCAT_PASSWORD

ENV RABBITMQ_PASS                       ${RABBITMQ_PASS}
ENV RABBITMQ_USER                       ${RABBITMQ_USER}
ENV RABBITMQ_HOST                       ${RABBITMQ_HOST}
ENV RABBITMQ_PORT                       ${RABBITMQ_PORT}
ENV RABBITMQ_ROUTINGKEY                 ${RABBITMQ_ROUTINGKEY}
ENV RABBITMQ_VIRTUALHOST                ${RABBITMQ_VIRTUALHOST}

ENV CAT_HOST                            ${CAT_HOST}
ENV CAT_USERNAME                        ${CAT_USERNAME}
ENV CAT_PASSWORD                        ${CAT_PASSWORD}

ENV MYSQL_HOST                          ${MYSQL_HOST}
ENV MYSQL_USERNAME                      ${MYSQL_USERNAME}
ENV MYSQL_PASSWORD                      ${MYSQL_PASSWORD}

ENV THUMBOR_URL                         ${THUMBOR_URL}
ENV ENABLE_XDEBUG                       ${ENABLE_XDEBUG}

ENV GOOGLE_OAUTH_CLIENT_ID              ${GOOGLE_OAUTH_CLIENT_ID}
ENV GOOGLE_OAUTH_CLIENT_SECRET          ${GOOGLE_OAUTH_CLIENT_SECRET}
ENV GOOGLE_OAUTH_REDIRECT_URL_AGENT     ${GOOGLE_OAUTH_REDIRECT_URL_AGENT}
ENV GOOGLE_OAUTH_REDIRECT_URL_PICKUP    ${GOOGLE_OAUTH_REDIRECT_URL_PICKUP}
ENV GOOGLE_API_KEY                      ${GOOGLE_API_KEY}

ENV COPYCAT_HOST                        ${COPYCAT_HOST}
ENV COPYCAT_USERNAME                    ${COPYCAT_USERNAME}
ENV COPYCAT_PASSWORD                    ${COPYCAT_PASSWORD}

ADD . /var/www/html/

RUN docker-php-ext-install bcmath
RUN docker-php-ext-install sockets

RUN chmod 777 /var/www/html/assets
