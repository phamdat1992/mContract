<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="google" content="notranslate">
  <title>mContract</title>

  <link rel="stylesheet" href="./asset/css/main.css">
  <link rel="stylesheet" href="./libs/pdfjs/pdf_viewer.css">

  <script src="./libs/pdfjs/pdf.js"></script>
  <script src="./libs/pdfjs/pdf_viewer.js"></script>
</head>

<body>
  <div id='viewerContainer'>
    <div id='pdfViewer' class='pdfViewer'></div>
    <div class='pdfFixedDiv'>
  	<input type='text' id='pdfInput' placeholder='Go to page'></input>
  </div>
  </div>

  <script>
  var DEFAULT_URL = './asset/raw/contract-template.pdf';
  
  	if (!pdfjsLib.getDocument || !pdfjsViewer.PDFViewer) {
  alert("Library not imported");
}

pdfjsLib.GlobalWorkerOptions.workerSrc = './libs/pdfjs/pdf.worker.js';
var container = document.getElementById('viewerContainer');
var viewer = document.getElementById('pdfViewer');
var input = document.getElementById("pdfInput");
var DEFAULT_SCALE_SIZE = 1.0;


// (Optionally) enable hyperlinks within PDF files.
var pdfLinkService = new pdfjsViewer.PDFLinkService();


var pdfViewer = new pdfjsViewer.PDFViewer({
  container: container,
  viewer: viewer,
  linkService: pdfLinkService,
});
pdfLinkService.setViewer(pdfViewer);

document.addEventListener('pagesinit', function () {
  // We can use pdfViewer now, e.g. let's change default scale.
  pdfViewer.currentScaleValue = 'auto';
});

// Loading document.
var loadingTask = pdfjsLib.getDocument({
  url: DEFAULT_URL,
});
loadingTask.promise.then(function(pdfDocument) {
  // Document loaded, specifying document for the viewer and
  // the (optional) linkService.
  pdfViewer.setDocument(pdfDocument);

  pdfLinkService.setDocument(pdfDocument, null);
});
   
viewerContainer.addEventListener('click', (evt) => {
                let x = evt.pageX - document.getElementsByClassName('page')[pdfViewer.currentPageNumber - 1].offsetLeft;
                let y = evt.pageY - document.getElementsByClassName('page')[pdfViewer.currentPageNumber - 1].offsetTop;

                x, y = pdfViewer._pages[pdfViewer.currentPageNumber - 1].viewport.convertToPdfPoint(x, y)
                console.log(x, y);
                });
    
    input.addEventListener("keyup", function(event) {
        var val = Number(input.value);
  		if (event.keyCode === 13 && val) {
    		// Cancel the default action, if needed
    		event.preventDefault();
    		if(val > pdfViewer.pagesCount)
    		{
    			val = pdfViewer.pagesCount;
    		} 
    		console.log(val);
    		pdfViewer.currentPageNumber = val;
  		}
	});
	
	container.onscroll = function() {
    	input.value = pdfViewer.currentPageNumber;
	}
  </script>
</body>
</html>